# Nacos 微服务学习场景需求文档

## 场景概述

为了更好地学习 Nacos 的配置中心和服务发现功能，我们将构建一个简化的电商微服务系统。该系统包含多个服务节点，每个节点都有多个实例，通过 Nacos 进行服务注册、发现和配置管理。服务之间存在相互调用关系，体现分布式系统的特点。

## 系统架构

### 服务节点

1. **订单服务 (order-service)**
   - 端口: 8081
   - 功能: 处理订单创建、查询和状态更新
   - 依赖: 用户服务 (获取用户信息)、支付服务 (处理支付)

2. **用户服务 (user-service)**
   - 端口: 8082
   - 功能: 用户注册、登录、信息管理
   - 依赖: 无 (基础服务)

3. **支付服务 (payment-service)**
   - 端口: 8083
   - 功能: 处理支付请求、状态查询
   - 依赖: 订单服务 (获取订单信息)

4. **网关服务 (gateway-service)**
   - 端口: 8080
   - 功能: API 网关，路由请求到各个微服务
   - 依赖: 所有其他服务

### 实例配置

每个服务启动 2-3 个实例，分布在不同端口，展示负载均衡效果：

- order-service: 实例1 (8081), 实例2 (8084)
- user-service: 实例1 (8082), 实例2 (8085)
- payment-service: 实例1 (8083), 实例2 (8086)
- gateway-service: 实例1 (8080)

## 服务间调用关系

```
客户端请求 → 网关服务 → 订单服务 → 用户服务
                    → 支付服务 → 订单服务
```

具体调用链：

1. 用户通过网关下单 → 网关调用订单服务创建订单
2. 订单服务调用用户服务获取用户信息
3. 订单服务调用支付服务发起支付
4. 支付服务回调订单服务更新订单状态

## 配置管理

### 全局配置 (global-config.yaml)

- 数据库连接信息
- Redis 配置
- 日志级别
- 超时设置

### 服务特定配置

- 每个服务有自己的配置，如数据库表名、API 密钥等

## 学习目标

1. **服务发现**: 观察服务实例的注册和发现过程
2. **负载均衡**: 多个实例间的请求分发
3. **配置中心**: 动态配置更新，无需重启服务
4. **健康检查**: 实例上下线时的自动处理
5. **故障转移**: 当某个实例宕机时，其他实例接管

## 部署和测试步骤

1. 启动 Nacos 服务器
2. 依次启动各个服务实例
3. 在 Nacos 控制台观察服务注册情况
4. 通过网关发送测试请求，观察调用链
5. 修改配置，验证动态更新效果
6. 停止某个实例，测试故障转移

## 扩展功能

- 添加服务熔断和降级
- 实现分布式追踪
- 添加监控和告警
- 实现灰度发布

这个场景将帮助你深入理解 Nacos 在微服务架构中的作用，以及分布式系统的基本原理。
